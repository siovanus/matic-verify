package main

import (
	"bytes"
	"encoding/hex"
	"encoding/json"
	"fmt"
	"io/ioutil"
	"net/http"
	"strconv"
	"strings"

	amino "github.com/tendermint/go-amino"
	"github.com/tendermint/tendermint/crypto"
	"github.com/tendermint/tendermint/crypto/secp256k1"
	"github.com/tendermint/tendermint/libs/common"
	rpcClient "github.com/tendermint/tendermint/rpc/client"
	ctypes "github.com/tendermint/tendermint/rpc/core/types"
	"github.com/tendermint/tendermint/types"
)

// const TendermintRPCUrl = "http://tendermint.api.matic.network:80"
// const TendermintRPCUrl = "http://tendermint.api.matic.network:80"
const TendermintRPCUrl = "http://124.156.210.161:80"

func VerifyCosmosHeader(myHeader *CosmosHeader, info *CosmosEpochSwitchInfo) error {
	// now verify this header
	valset := types.NewValidatorSet(myHeader.Valsets)
	if !bytes.Equal(info.NextValidatorsHash, valset.Hash()) {
		return fmt.Errorf("VerifyCosmosHeader, block validator is not right, next validator hash: %s, "+
			"validator set hash: %s", info.NextValidatorsHash.String(), hex.EncodeToString(valset.Hash()))
	}
	if !bytes.Equal(myHeader.Header.ValidatorsHash, valset.Hash()) {
		return fmt.Errorf("VerifyCosmosHeader, block validator is not right!, header validator hash: %s, "+
			"validator set hash: %s", myHeader.Header.ValidatorsHash.String(), hex.EncodeToString(valset.Hash()))
	}
	if myHeader.Commit.Height() != myHeader.Header.Height {
		return fmt.Errorf("VerifyCosmosHeader, commit height is not right! commit height: %d, "+
			"header height: %d", myHeader.Commit.Height(), myHeader.Header.Height)
	}
	if !bytes.Equal(myHeader.Commit.BlockID.Hash, myHeader.Header.Hash()) {
		return fmt.Errorf("VerifyCosmosHeader, commit hash is not right!, commit block hash: %s,"+
			" header hash: %s", myHeader.Commit.BlockID.Hash.String(), hex.EncodeToString(valset.Hash()))
	}
	if err := myHeader.Commit.ValidateBasic(); err != nil {
		return fmt.Errorf("VerifyCosmosHeader, commit is not right! err: %s", err.Error())
	}
	if valset.Size() != myHeader.Commit.Size() {
		return fmt.Errorf("VerifyCosmosHeader, the size of precommits is not right!")
	}
	talliedVotingPower := int64(0)
	for _, commitSig := range myHeader.Commit.Precommits {
		idx := commitSig.ValidatorIndex
		_, val := valset.GetByIndex(idx)
		if val == nil {
			return fmt.Errorf("VerifyCosmosHeader, validator %d doesn't exist!", idx)
		}
		if commitSig.Type != types.PrecommitType {
			return fmt.Errorf("VerifyCosmosHeader, commitSig.Type(%d) wrong", commitSig.Type)
		}
		// Validate signature.
		precommitSignBytes := myHeader.Commit.VoteSignBytes(info.ChainID, idx)
		if !val.PubKey.VerifyBytes(precommitSignBytes, commitSig.Signature) {
			return fmt.Errorf("VerifyCosmosHeader, Invalid commit -- invalid signature: %v", commitSig)
		}
		// Good precommit!
		if myHeader.Commit.BlockID.Equals(commitSig.BlockID) {
			talliedVotingPower += val.VotingPower
		}
	}
	if talliedVotingPower <= valset.TotalVotingPower()*2/3 {
		return fmt.Errorf("VerifyCosmosHeader, voteing power is not enough!")
	}

	return nil
}

type CosmosEpochSwitchInfo struct {
	NextValidatorsHash common.HexBytes
	ChainID            string
}

type CosmosHeader struct {
	Header  types.Header
	Commit  *types.Commit
	Valsets []*types.Validator
}

var (
	SpanPrefixKey = []byte{0x36} // prefix key to store span
)

// GetSpanKey appends prefix to start block
func GetSpanKey(id uint64) []byte {
	return append(SpanPrefixKey, []byte(strconv.FormatUint(id, 10))...)
}

// NewCDC ...
func NewCDC() *amino.Codec {
	cdc := amino.NewCodec()

	cdc.RegisterInterface((*crypto.PubKey)(nil), nil)
	// cdc.RegisterConcrete(ed25519.PubKeyEd25519{}, ed25519.PubKeyAminoName, nil)
	cdc.RegisterConcrete(secp256k1.PubKeySecp256k1{}, secp256k1.PubKeyAminoName, nil)
	// cdc.RegisterConcrete(multisig.PubKeyMultisigThreshold{}, multisig.PubKeyMultisigThresholdAminoRoute, nil)

	// cdc.RegisterInterface((*crypto.PrivKey)(nil), nil)
	// cdc.RegisterConcrete(ed25519.PrivKeyEd25519{}, ed25519.PrivKeyAminoName, nil)
	// cdc.RegisterConcrete(secp256k1.PrivKeySecp256k1{}, secp256k1.PrivKeyAminoName, nil)

	return cdc
}

func getHeimdallGenesis(height int64, change bool) {
	client := rpcClient.NewHTTP(TendermintRPCUrl, "/websocket")

	vals, err := client.Validators(&height)
	if err != nil {
		panic(err)
	}

	commit, err := client.Commit(&height)
	if err != nil {
		panic(err)
	}

	genesisHeader := CosmosHeader{
		Header:  *commit.Header,
		Commit:  commit.Commit,
		Valsets: vals.Validators,
	}
	cdc := NewCDC()
	genesisHeaderBytes, err := cdc.MarshalBinaryBare(genesisHeader)
	if err != nil {
		panic(err)
	}

	var back CosmosHeader
	err = cdc.UnmarshalBinaryBare(genesisHeaderBytes, &back)
	if err != nil {
		panic(err)
	}

	if !bytes.Equal(back.Header.Hash(), genesisHeader.Header.Hash()) {
		panic("invalid")
	}

	fmt.Println("genesisHeaderBytes", hex.EncodeToString(genesisHeaderBytes))
	if !change {
		return
	}

	changed := changeHeader(&genesisHeader, client)
	changedHeaderBytes, err := cdc.MarshalBinaryBare(changed)
	if err != nil {
		panic(err)
	}
	fmt.Println("changedHeaderBytes", hex.EncodeToString(changedHeaderBytes))
}

func getProofForSpan(id uint64) {
	client := rpcClient.NewHTTP(TendermintRPCUrl, "/websocket")
	resp, err := client.ABCIQueryWithOptions("/store/bor/key", GetSpanKey(id), rpcClient.ABCIQueryOptions{Prove: true})
	if err != nil {
		panic(err)
	}

	respBytes, _ := json.Marshal(resp)
	fmt.Println("respBytes", string(respBytes), "hexBytes", hex.EncodeToString(respBytes))
}

type CosmosProofValue struct {
	Kp    string
	Value []byte
}

func verifySpan() {

	// height := int64(6404703)
	span2695ProofResp, _ := hex.DecodeString("7b22726573706f6e7365223a7b22636f6465223a302c226c6f67223a22222c22696e666f223a22222c22696e646578223a2230222c226b6579223a224e6a49324f54553d222c2276616c7565223a2243496356454943756e4167592f392b6343434c5a5977702b43495142454e6c2b4941676f6e53637951515345477779366243663035337659707842664477714634566a4d7a446c496356676c665953486e437073563850593877766f7642347a672b62544b64734e6b79485738564730614a7878376249536a444c304e7a44614f685143434755716b377231385a596f53652f505635587178304f61586b494e4d5449344f5445314e6a45774d4445354e5644553070446a2b502f2f2f2f3842436f41424343415177536b677551496f35386569416a4a42424e45696a4d34695568543848446246724862322b65493554656c37377056686c2f5979362f514752702f2b495947547248516c3262676e736239704b4c705a5a775138666f6a676e33756c397152566d6145563773493646414c3341584c33394a426c4e6d584a763677475a68523869764831516730784d6a67344f5451794d4441774d6a6b79554a326e686f7a2b2f2f2f2f2f77454b66676876454a31594943736f684b78424d6b45454236314c4a3175656e485043646a6e6b5a357857445563367267782f775275492f374458533532376e5a5651326f3761564c4f6c336f374e74437762616b6458336634696436337750793441702b31386f4c2b5875446f554177613330776c61734169536357624e5a49714d7039766c50775643445445794f4467774d5449314d4441794d4456516b3953736d2f2f2f2f2f2f2f4151703543444551786a4567474369582b775179515154464461726968496561376f587a4751543273445a695a337a796d5451644f71476b495046435a3261357475476a33695a2f67762b4441434178416a527043665972612f65536566526a46786335556637482f3031664f6851457934325166396f5348395064634c30752b636545483344745030494e4d5449344f4459324e4445774d444d304d6c4471694d7538416770354344385135546f6742796a76706263424d6b4545434951336f3237706e5374786c567a504c6879662b7a4c3237623867627966503768416e726c58356c683473547262426562694d493332316a4d454a7a4a66684451455576697171497977656b697a693457744e37546f5542567659416370784b3033665a39754c776a2b327946454e55726c43445445794e7a517a4e6a4d314d4441784f546851674a79724b41702f43444951356a456748536948716f30464d6b454561586369655346454d676a2f6872653444435352435a70634e434342425a7367615371434d613843754d5a433859477a53482f2f36584b6b6447384b31576b47515879434f4d6b324f6b435638516853764e745944446f55454b306e71577a622f386b4b73376737397057524643616d6e313543445445794e7a63344e6a45314d44417a4e54525173366a593576332f2f2f2f2f4151703643435551677930677241516f77643655416a4a4242476d572f59685757394455347278525975676975302f585953626d51645769514d2f784230515238686647316c412b7032467645436c38353252734635544e58647642367657304577386d784479634e5036313767383646424a32686462645a6f4d49586153326f4548767a76466f486c7963516730784d6a67354d4463304e4441774e445531554b586c6755734b666768794549785a49476f6f68596f524d6b454554366d73356746735a5550734e3659795235426a50624c5664582b39417374345338465a654e7871483779787551656979726c4c4a783065574d6c7536454d7457507a353876707839703563516862594d4c4e65737a6f5545366e586a306353706c5a3431334e57676f4762543039304a547843445445794f446b784d7a557a4d4441774e7a4651693666476b762f2f2f2f2f2f4151703643447351736a63676951456f687378434d6b454546706d36574b797357336a767a6a7670797437574d4a4838743256573163526e49526a6d66524a4a2b626d323546737a3037477452367672574b78582b74315a2b4273597a617052346f444b665668752f6f7943436a6f55453978542b6c546e316d4c2f4d46747350766c516b4d4d6478585a43445445794f4449774f5451334d4441794d7a56516f6332706d414d4b667769444152436b6653414e4b4e6950416a4a42424d74334b464e746c37584e50575243457a7166534765566d55473246683234797663794b59474269533059546b354b6c65456d315a36646d44697336735845506e5052584e31737661424f675a6158384f4c68577477364642594d3376594f65474b56636f70756f7a54416b534f4f52303442516730784d6a67334e7a6b324e7a41774d6a4135554a6d34797144352f2f2f2f2f77454b66676762454e676f4941306f673763424d6b4545395a634b6d6a592b6f336f734f51554765443255714f5876772b7254387970434a4b534a33706268636e5069474234766278634346636d466b4a4c463372444973677467414877376b49426c617655384670626b38446f55466f736e6552527271474b77544b46474f465a463764756457533543445445794e7a55344d54517a4d4441794e544a516e73537a3076332f2f2f2f2f4151703443446351336a55674343694147544a42424d6f326f316b64345035383756626d4563426e7578627251446a507942716e66717168416264314d6a476a3037796a436a596743676c556344784b64346363584b62584f3246754151706a6c6d544c335545724f42593646426a7a63613775546959323333695a4d636e4e512b58587479316d516730784d6a41334e5449304d4441774d6a5977554d6567314b4943436e6b49597843315543426e4b4d4c7655444a4242435a7945486a766c776f4630587867774c42645532716e465233556967353873792f7263787134494b7a31334f416250506a6b5a534276377a4c3075396a4d573278696b4736706550646d7a4b327872666e43594659364642705868706d56624346307448597436564d577336304a756a5470516730784d6a67344e7a41344d4441774d6a5132554b3758686f4144436f414243413051765230676e68556f72754b654c444a42424c7935644242536f62675930634a42433564665874392b4f6d544b7535397a7974626f675a3274657841356158764c31723970326431626e544e526c4c4e7448352b3630796d68692f2f5778656e7361337a763159413646427970635a593732307569767a4e386b475947644b7a2f572b732f516730784d6a67354d54677a4e6a41774d546331554c696c724e722f2f2f2f2f2f77454b674145494a4244634b79436d41796933777130424d6b4545746c6254625156384442707136424b416d516950546d51626e4630465656526b4c3561383170436933585334535459796c76577a4363324455546741567337367a484d596f666751565a6146367152706c48533844546f55485358494a3676555a6a6837326743304b6635796869665737755a43445445794f446b784e6a63774d44417a4d545a51382b696a6f2f332f2f2f2f2f41517034434773513346516745796a7575687379515151624d6342522f4d544c36646351464c305631552f5064533963434d61775261735a3532463761453047314c4a793752364e37625930644e65386c5a3330313137792b6c38675a426e36786f43616f524d496f7631644f685166764964476c31575931597348562b73714a7a4d6b33536a326f45494e4d5449334e6a4d344e7a51774d4449304d564473764d682f436e6f495242436b507941454b4e66707a414d79515151474f59634332302b56363368495a7770496a2b7a6642777944786e6d57554f46516e4b5a4e45666a506e2f55706a2f794b3958675466664a4f785a6933652b565878614b57592f2f67686842736e357741674873544f68516c77792f573758754551316f69494954765039757a596c4b34336b494e4d5449324e5441794e7a59774d444d784d46434379377a4c4151702b434677516830346749696a312b776f795151534865766e6c346d764b5435426a314c72796744704a4836307947595a646e562b397075337158687762516e4c553948424f34576533634a464a6a573634524337347132777257674a794b7858673561734d6f6e6f414f68516d79417a426b374a3963394c4543554f7337486630326978623245494e4d5449344d5455324f546b774d4449354d3143676c2f37362f662f2f2f2f3842436e34496142444f557941594b4b6e38427a4a42424f51566e452b6575434a3468644e2b71596a6345733848465572324b75634346434b684b4e566f4d59375652597863504f366a334174396f30516b55565935786f7032704959557465422b77314342552b4767374641364643676b66654c5a6770387767496d5853626b754e4a576342725763516730784d6a67344d5449354d4441774d6a453555502b6c7162372b2f2f2f2f2f77454b65676763454e776f49444d6f39724335416a4a42424c4a4e55504262626e43616b376f54316e53457831446850374c7270307a59656a632b6f686b49766964434d7363447a4443395a695979417164467a3754794239564761484b72754a395064656c6d3051354b692f633646436a4131444b46494f312b686c666546423775644b6c5573487766516730784d6a63304d546b314e5441774d6a5179554c4f6a73744942436e34496342442f574342564b49797241544a4242496976735345546d766b6d57667269686561363569444e2f6c3831364d31734a6d344c6e7645666b6166496d4b6833434962374a70792b534d51526366465867566d2b725138366a4865715235534566335744615355364643715a6a4d433751397852446c492f347a79504841532f59486f65516730784d6a67344f44597a4f4441774d6a5932554d717968654c2b2f2f2f2f2f77454b6541684c45494a4249416f6f3750524a4d6b45455162326e6847704c38443151756f486e38494c50747a5a54546c3233495477517a75434c626b34537855595030512f2b4954395a6e2f6f334b486e6767444a41795633434a66634853363438445053436a544b512b7a6f554c48544b6357656338536d5a4e74595154594a636c6c52496b487443445445794f4463334e4449324d4441774d7a5251685a7a5965517039434330516c7a456743696a3862544a4242446d6a497934597769683273672f42786637787373364331546b2b666c6b6d49716f6e4648484772674e6d35706835764d4843775a323644427362656a4f3635493364707558524d4b2b32683930756279574e4b414936464442534e536573375137533963345849516874485367744f764f50516730784d6a63314e7a51784e5441774d545178554f2b362b3537392f2f2f2f2f77454b65516841454f38384941736f694b6d3341544a424244547a446c37522b38524d6530477745307949594a6643375a6a5263554773514f4235616e784f7954774d487337735157415a4b3874316d583958394b4a344d304f494e464243477364513832437270617943624c5536464444644a5378384651386d6f36427554713270357762625036574d516730784d6a63794d4467344e6a41774d6a4935554d332b2f30634b66516753454a77684942556f346d30795151536b7a5a384e577a536c636e446f706d484e5335324b583139736d2b2b53416474637a654b397a485344345675515454304a593355685a3278707657763635426e787a6a4f3535724b425375444d45343572763259474f685133544965326330436545775539765458723647692b517236727855494e4d5449314f5463344e5451774d4449334e31446f785047712f662f2f2f2f3842436e7349667844795953445042696a43766f6b434d6b45455179316f614e5677305746776e466e78716a65586e795653767251633642486f385056584f774c4d5447694d474b636c6b41653638574d53747272423153457851584f324470466c2f3978473337486f7266782f66446f554f6656465745434854304a527a354b785457332b454e5050496a5243445445794f446b784d6a497a4d4441784f5464516e6344307977454b66676870454970554942416f306f55434d6b4545664d373668474436366a7142744d3542766d4c436e71485077616a396f72506b36324e4b5041714e6f51536b7952622b42684b364b75497550736d3455683736722f7a616577577670494a7230324a43374f64577a446f554f7033313338744d77514c4f494e51454e4b4b787573716572394e43445445794f4445324e4449344d4441784f545a51764a724b36507a2f2f2f2f2f4151702b43443451396a6b6743536a71724277795151523631543833424948724336766c5135474172326c4379324a79302f347069576c7166324d4d455855766b676d6c63552f4f316e6e326d42746163415350486e7267584f7576744e2b6359796361777171704d3650664f68524162442f7657576d7a596a4739567a7266773034573955306a3445494e4d5449344d6a49774e4463774d444d324d3144746a4b37392f502f2f2f2f3842436e34495352446a514341344b4c6d6564544a4242455843675638424958772b666e4d4442426c7666584c45514468363362387674304e796a692b2f7071315958374c45325a617a565757583871684659543661527079715a5a4e4b5663516371646d4379357477646645364645464c53316f71446a41376954594f326f4e5a697264774c713445516730784d6a67314e446b314f5441774d546b32554b7151386f482b2f2f2f2f2f77454b6567685145504245494f38424b4a6676736763795151515759675a64426473464738376a705654765842787369796c476f3476456939476e44735934466b524b4c5a335751547a655772416d4a48555a764c7362694e757a757939692f576f4b394850666c343241725731364f6852423162506937464e594f384267486674504b68476a6b6753556955494e4d5449344f5445774d7a67774d4441334e31443139705956436e674942794346465369367a3638434d6b45454e534b67424145736c304277503264726c625553487431794e2f73504743773852656648703336715a36494f625172414a6457396c696c622b5634756831717971647063446c52376651444b6674347a776241346b7a6f5551753738326762713148584e34334d626a72453436497a5175734e43445445794f44677a4d6a4d784d4441784f546c51353543673977494b6677676f45494575495038424b502f6453544a424250344f645364765a6e777a58586d4f54424865696779354f4c51656b64547868506f523873734a68463762573979525430326f666246524876622f6b484a7851716173773956646c6a4e516c6977794b486c5954716f36464550487755325547586f77704532724a372b7a37756e67564a6255516730784d6a67344e7a4d784e6a41774d6a4d31554d336e324976392f2f2f2f2f77454b65676755454b41694947516f6736486e42444a4242434479314f6a4b49512b5a646f49646c5036665630454b4f414439564145484a7364444e716343397959584668687548344e4f4a486f36734a57716c7139384e6d4e6c4c7154454b7568653669664376696e4c435841364645534b6f575a663466726d3061414b6b676e71597466633242704c516730784d6a63314f5441774d4441774d7a4930554a5731774d3443436e6f4958524349546942484b50443676676f79515153764b304a57585677693054552b49354e7238792f515a4330714c465a39686d4531307556482f455a35556b6f6a426851627768544a614a5076624730784c3957384e6c5372752f4f3353736c6867504443373675514f6852476f3651623254496b54644342687554426e78702b534d764e3945494e4d5449344e6a63324e7a6b774d444d784f5643756a5048684177702b4342385170436b674f7969346e4555795151544d656772617064574c6935722f5a326c765575575651614453434d497656676c2f6b6c49756e6b32706933337438704a4d75326e70496b464c76416b5054696a3274436f78447061727a7667464f616c64757055444f685249722f5a7165707a6a7550785059736747424c777844742b557a55494e4d5449334e5445354e546b774d4445794f5644716e7465302f662f2f2f2f3842436e6f49485243434b5342344b4a335373414d795151544854654661546d4972445565566744546158344e322b505044616e6637674834725a544f35755552612b4d485a31796365446930646e6838654b586146456b46464a52664e4a57574b51342b7469354345456f5a654f68524a49393648685436566452714836763656656f696c5a4468397245494e4d5449344f5441354e7a51774d4449784e3144796a64794c4177702b434649516930556748696a383642557951515149714f7330374d756c422b577146756544342f3037784c634c4852436f797a30785a306f62414c2b6e6c6f555578595253436f5631704b2b3075795738454c7170646a6e78766a674e767a367335494c6156354a594f68524e38302b7367785063303051675a4c6b4f49684b61324374524130494e4d5449344f4467344d4459774d444d304e46444b367033342f662f2f2f2f3842436e73494b78434c4c79444f45696a596863676e4d6b45456e4172773841736a4e72337a7144744b614c576371742b452f6e383657596775555854744c513257736666474e3449412f496f41672f7a58774d396930554b73692f75786839755642724166533558307163364f34546f5554345676656656466b71534d69686f66723647776f36774650356c43445445794f446b784f446b774d4441784e545651304e2b427a414d4b6551684d454f6c4249426f6f7138685a4d6b4545306c2b3145583147734e4f56676b46324b693351536b6f43737431466e6e46586143543657302f6a7764444955654542535273464d5067685835314b3547326f5431664339446539337365513047566e69515939697a6f55565071315878676b6870416d52326e766e4173384d4c673053343543445445794f4459334d546b774d4441784e7a4a516936476e6f77454b66516742494c456e4b4b486935774d7951515138552b7075475754675a77334a72484b7a496b49486946314d58776a4b76683451674d5a692f65776e6a6e36444e356831664c585045685248334e4171466641513630716f664d3773736a3271532f6b45455335334f68525a633547436463416655465664524f6b736e5a7331504b32745645494e4d5449344f4459784d4467774d4445784e564451393966582f662f2f2f2f3842436e6f49666844765953443141536934364f384a4d6b45456e584f446d326250337330757a4f44667276796e6670376a70355774556364536c30776b4f462b51533955585275424c54417662523061664a4c2b6143366a496b42473257444f46447735596d676a4f72786866736a6f555778427653664d47494b42375437334f757834497477535a79464643445445794f446b784d6a49304d44417a4d4468516874432b4e77703843494142454d3969494a30524b4d62626a6755795151516a3871477356634f4837536c4a764d57586e4a554c4a4d5a6c79397a6c4f5a45375a6a51742f6f5a6f562b4b33586c4969534c654f586b4f3163314541574f6d39627570584d695849306d77724b723367353146724f68526548345448393947616a57325269744b313978536d35644846556b494e4d5449344f5449774e6a6b774d4449774d5643486b6453454167703643473051793155673341496f7665613141544a42424f42493275696274434e6431434671564b526a456b4a3975632f3767705766534d756e6c2f42474265364d523832514a6135776d637472794133756f62366942364a74533037493731774d3075303263617a562f33383646462f70506439456b4b41695637377765664a4a686c444a66455465516730784d6a67354d44597a4f5441774d7a4179554e484a36784d4b65676873454b56564943596f6c6f323841544a42424c6b6438776543496448784f6e2f736251636a4434654f507748453039502f534778414f75614b6c62364153506c7a696e64793653696c54557764704d7a7166555a555751353445446432693466513371475a72726b3646474933737138534f4e456953474d4d3468716f54776c5345694979516730784d6a67344d5451334d5441774d445135554e483539365943436e6b495678436c536941644b4c333062444a4242503938734e6a4e596e5273576c33337434574637535672444d764a326749486b4f6a523979314673306d657a5176483372466d764e6d466e65444a74344d2f477644386b4f564d5654707a7737743135475a733950633646474b3861704c30704e4431744f46705a37694e73746e686c736e35516730784d6a67324e444d794d5441774d544d33554b53446d354144436e3449644243775753416d4b4e6135437a4a4242423537454558366a59334f585a6651496471616356535a53465677757a6a5a3179337248486237793442443965314564383931626d6a6550356a5a52323234322b35584232554d6b6450556d447279694a7a70616d593646474c375a323232543466394667494567515a486247413231457953516730784d6a67344e6a63774e6a41774d6a6330554c506e2f74722b2f2f2f2f2f77454b67414549646843345753444441696a352b3849424d6b45454a64474f5769497041632f70496d6e6c6f48504a64356c6439715a314c377a734430326e3643392f79314f5664526d4946734d786848704f386564505136345748443449657a5a724a43744a343058387271396b43546f55616d564d6f372b317a374937387775767635617a7475776d75773543445445794f446b784e7a497a4d4441784e7a6c51737143713666372f2f2f2f2f41517035434659516a456f676877456f317678454d6b454535496a2f623967667368392f774a6a334a33687632614e46545135364445692f337779774569676d44622b64665077387062316e4271556c6c7a4b5a574a75716274484369724f584f38675564784a304f4f366a767a6f5561793758354c45715645796e3068582b32463342596b445753757043445445794f446b774e44417a4d4441784e444a51344e57304667703743424d516b5349677567516f324a694741544a42424271597548576d4c674f7155645949457456394137497455624e732f35484e514844625a4d667251676168705069324a6c39696c7752657051644e6d587374586242426352576b3552646445446b45454d47617263343646484c354f6964413441455331664c4f394154417168623634682b6b516730784d6a67354d44677a4f4441774d6a597a554b4b3939664942436e6f4952684448507941724b4e7a6f324159795151546a3264515932433567334b30574a486a34353959324c49315953304c4a506b716561746833715548437365574b4658477a6e496b78626e68796d756b5a432b2b496d6c6a6f522f34515450384234635973732b31484f6852304c52507773714763676a76644e6973574d463548424c6c364f45494e4d5449344d5455334f5463774d444d774f464457396450374167703443447751357a676743696a58457a4a42424a30643631633332696a4c484f727047322b7845714e71505a3832307230753279655376742b424d51783964684e6b745343384b4e6743716866624171594e533753592f476e6367716d5a44645975394b634a6e6d413646486675464e4770756e4577746f61334e714d5774623864504d7332516730784d6a67344d4449314e6a41774d546333554f614434656f42436f454243474551345538677767676f2b2b3654386745795151542f57346d334f694f765343487751495a6a7457384d59697469494b77556f79507471472b434a4c70703755644e2b436839735a6a394254516c6c6f536757314d6f37746c775a4a304a7869716c39354256496f57304f6852375541437669726166315a3677315056324b2f3958796342446855494e4d5449344f5445314d7a59774d444d314e6c434d37764c722f2f2f2f2f2f3842436f4142434567513355416769676f6f305054494f7a4a4242456d307944526a54476954326b71776e315430466e4f492f794b6451414c704a6d576d4a654d4c422f374b4f716b4834534e4f583641793650484e4a33797650546b6c4536794b514f4b497164704675794275304377364648787a65564d624b753643354d6f473142646445376e4c3676314a516730784d6a67354d5467304d6a41774d6a6730554d796c7964762f2f2f2f2f2f77454b664169434152444e61694469434369336d3549444d6b45457a686368376c683671377071502b7a417853436555784f5a335a4f6249376868517434684675766a6a5244453475477230475a655555304e4b4948355a724566526d3875747852584e594b747a49666975444f56757a6f556667484877614b56684f626c54437a6b51784e47483668416b763143445445794f446b784e7a597a4d44417a4d6a52516e39724934774d4b66776751454a49674944596f774d667a41544a42424f6f6d4b42624d446c377a5161717430614b5637472f47577678476b68757168712b7334372f4248664635756c676c73554f52506b4e4469564c35564d4f6a5370317279474d2b7657665358556d504f2f527938315936464836414a424d74422b506d6e4a76434153332f3477433578594239516730784d6a677a4f5467794f5441774d6a5135554a7a322f4e662b2f2f2f2f2f77454b65416746494c51524b4b624c7a77457951515235372b6a4643782b5a492f534b526e374b774b5a4d4c57764b7161356e34545866684d724672745579483579374b634556386d334954793777356636696c6857456a486e576b4d7367584d454e61494d6b726f764f4f68522f7a566a43315432594379522f46684c397570507070324754356b494e4d5449344f4451324e7a55774d444d774e4644386b4c6d4c4167714141516839454e4a66494941474b4f62747151457951515270315a744a746b4a4852726e664a64447647444253494c43494142594f774e74354d6766736b6a6c774134695a44772f436b544674414f76357764742b65464972586f50744a6b42387142576b666e625756464f784f685346555841693434424169326d4f6f4f6f336e5374702b5166426d55494e4d5449344f5445334d4441774d4449784e314367746465652f762f2f2f2f3842436e384968514551753441424941676f73326379515154755970526337777549584a683447414c663271746e3578424d77774550707a7678656158667a71554b3745454d6267635742586261384c706336496865654e355857544f31577a627249784964333470344d6673344f68534c76354c30327076675234526b6f486631677176587474385a5045494e4d5449344f4451324e6a49774d4449304f5644416d3765422b662f2f2f2f3842436e73494352432b4669435441536a78304a59424d6b45455a74427859416f6d2f7a77456176742f56573749514c4f66572f4769646d436c397a6e3069584341666f437831424a55632f2f564c7253552f51636c5633664f47595a566b494e3970473761705139333145635342446f556a4c4567523436564133594756734838724a77564f52574c32315643445445794f446b784e6a67794d4441794e7a465168624f2f7441454b667767614549636f4947676f31635357426a4a42424943306a69517a67326e4e50424352505362397650563759544d7047696a434f53733273343239437a66455467642f525648767a695876452f4534754a6e6b77372f74787570443153754a4e55626252626c78366641364649365841446b766b6b616d78624d75342b7a765747385662746144516730784d6a67344e6a59314f4441774d6a633455496578787644392f2f2f2f2f77454b66776850454f7444494f59424b4b375054444a424241554f6c47726b4463736e65764a73496a4f506962666c6b5370445830587559796b7a5a2b6c337a69622b513371465567533033704f573338664f35726a5a4b2b4a714e794e654b767a5a757142564879657936396b36464a437845554f67793254675a30416a4237782f496e626337494a51516730784d6a67354d6a417a4d7a41774d54597a554e506374354c2f2f2f2f2f2f77454b65516771454d597549424d6f704c77474d6b4545486578515256337369783474336f426936516f6377657070332b36694e4257383751636249664d6154536839666a3733396e412f6566702b562f77726b703441476849304b67422b617966595a4a6972382b65674e446f556b5a4e5855626f7753557850306e61747a784e4f7a576234374b5a43445445794e7a51314e4441774d4441794d444a51762b32682f41454b65676834454b5261494f4d434b4c5774556a4a42424e7864354f7a4241504576314766705a30346f6c4c514745526a69454e4f39476335542f72586d3379544f4742483847594e4130477a70386e587257335a4c66595a4d69426779545259615473334c67626b5135654936464a5563694279725765316d6d5257697345366c6368594165553744516730784d6a67344e6a6b7a4d7a41774d7a6778554c715a784d3442436e344964524333575341454b4a5067416a4a42424255477659665368452f6f7532444b5033386f624b6d5a4837463067354632614246507a48314370774835586d7144556b7539335874633867454c6a73566252336b39625265623955656c55456f2b76777563304c6f36464a576154595637634848446948692b756478334252746637523339516730784d6a59784e7a67784f5441774d7a4578554b6275714948392f2f2f2f2f77454b6567674d454a6f644944456f6872324241544a424245764a587962624b663068494568783977456152676175676c5034656377616d497349574f4c5a574a54552f6975786a55624e703457545a2f2f714d3054723335594c4373427a416a5931717479316e30657770357736464a6a43664d50774d42746963675364772f6c793476564365415970516730784d6a67344d4449314d6a41774d6a5130554f65526f354d44436f414243494542454b426e4947306f69752b6d416a4a424243664b53645239364938555353736b42674b524f7856634e79304d6937642b506832647038644762507a596d53774d774e36796948713832492f766944595841524466674855497465503544626f74464c4447576e4536464a7857387a75576a344f534b387a32313269626e4967362b64354a516730784d6a67344f4463784e5441774d546734554a48342b4d44392f2f2f2f2f77454b65676757454f496949416f6f69624b3341544a42424d58466e506a53766d5375725169454b4471475536693468613142422f54454a7056507143734b384b62386e677072542b353550414a495569314d4b346e2b6e5531744261514c63614c2b78397a6f6336314b73656b36464b4f2f666d595949767a4538684b656b776c73753344633574504a516730784d6a67314d446b344d6a41774d6a6734554b4c6538376744436e34494a6843304c5342534b50664344444a42424971536e715266794b54685048753067676177564a7972745639734345394a53696649633138683064384836397035767250326437784c6d476766745a372f2b4a7a4f797338344148544677306d6c5859533845613836464b5769774f3732376a354c432f6565444a4e3430514854792b7754516730784d6a677a4f5451344d5441774d544d79554f6672356372392f2f2f2f2f77454b6567674f454f676449444d6f735a336d41544a4242415679397272434d67314f71524b356e4f61436a4e6a6450673030636667514c666577586469746835476c5067443353322b4a535a356444412b43564b4d39685a523068712f674a57564443354e4634634a4c77743036464b585670384c7230714f42392b6c596455774e616931476d784d62516730784d6a67334e4463314e4441774d6a4177554c7171325a5942436e6b495a424332554341584b4f575548444a42424a7354376f6e525a4149312f4a5134356b43323678626457634d504c6870576377707257765367576f42485a746251666978453276395157307533396a567a6b4939514c773956764f4d545469784c5a4d35464d4d3036464c4270582b4e3274496f2f4f51514f7537495a4c70476361347136516730784d6a67334d4459344d7a41774d444d7a554d6574315a7343436e304961684366564341514b5078744d6b454572447a485348473352656d636b326b736366467751516130306b2b4165694836453730534f704835374c5450544e6441374f6e3278464762514966334c305a5a4b4135496b6d4e7533624465574d555a336f304649546f5574637450327a66702f6f31376a30637961424b4e2b302b474c303943445445794e7a49334d5445324d4441794e7a4251383543742f2f2f2f2f2f2f2f41517034434151677a68516f3435793142444a42424c5468315773304b6664315a464a43612b5952355a5865764c6859315a39483070374a3357354c5648334f46546e3574785245494c77776e655357747731747866457a5265376f586d742f737a4c4e6e7a5a4f38533836464c634338636b5653736e416a614a48714f4d4f35764c7a4e7a3942516730784d6a67314d6a55304e6a41774d7a4131554b444676646742436f454243486b5176566f673042456f6f7558676a41457951515242352b7a563574322b6475507033455235347466435438586b3241304f34615175487833464168773767367a4a44723174304a70664c7750467a2b55764b323066614d566e414b5a6b6c71466d5033484a733659314f6853336e36314d715946484a454c31505259325839384442662f593655494e4d5449344f5449784d7a4d774d4449784d31443969624f412f2f2f2f2f2f3842436e6749416943424653696d6a716f434d6b454531724273636c3955454f544d765757516273345941325472366b6b4373684979776674596b716472352b37434a49413566577632552b6d72353678515131376b637257545a5035347358724c4b2b495262354b6e627a6f55754c73566935504a54744e6347584457454e48697330346d5a537843445445794f4467344f5445314d4441794d5446516c596e356d774d4b67414549545244315169435941796a4e734d77424d6b454547422f3432455049577a647a5545753370704d336a75314b4954656d714d64646b63577373396c3464737842566443496e5469534248644b726e4872496f6759456c4b75753369314a5a4c452f726f31496b336942446f55755631445866503473716a5975634b3379485a736d7562746a4d6c43445445794f446b784d7a63334d44417a4e4468516a612f783966332f2f2f2f2f41517037434873516e3177677641516f78364833427a4a424248627373306b68415979314e5a2f42616f356e625042563562465670467052334c49384b63466851797344662f4737693053686b4e4e6e4943774c625752344f466a6b772f49797a3864594e756765487a446f30624136464c7867525053686149324c685a61703939526c6e676d595875766d516730784d6a67344f5455344e6a41774d6a5978554e47666d2b4d43436e384957784347546941314b4e4b612f684d7951515430373748634a633832553651493432514b4539455956627773325a5635647465546f595352316e544a6d3951514d5376346b665472682b4e38366d4e7933644d655950734f736c58686c365572357836753969746e4f68533976554e4873494c5a31723379326b56566f337a6c4b6934684945494e4d5449344e7a59784e546b774d444d344e564470397561722f762f2f2f2f3842436e7349656844445769444f44436a33392f63444d6b45456f42484b635734697336576d4861366d7a4c62793732766f6a68663053785152462f77317364636f744976454e513250425844304446365078532b727a7475445653484d70766146307747756b7061656b43574155546f5577502f6258704f4e62654c46356530313765446f67633237764a7043445445794f446b784d6a6b324d4441784e6a5651305a544572414d4b66776769454e45714943496f6b66506c42444a424241635a4d4c5058635854363544335076376f776551676369754e346a50414f64592f4854686e61664c786c472b49326337416e796f565844514958696168394f736267546e455543735459774a33545864326c4b306336464d4e575361365a766f494d6579414b4374304a755731774d744979516730784d6a55324d6a4d324f4441774d7a4d7a554a53446f72542f2f2f2f2f2f77454b65776765454b4170494977484b4e4b5a6b777779515154674f6273356d6b73595835665468437342732f3647353553372f6a6e58455174313351636e3170363445557246633771637366733031376c454a5433366d44496e61514b69672f383559467643646a6e5851452b414f68544768704a58494634677771513873784e4632314e4b374c5366626b494e4d5449344f54457a4e5441774d4449794d4643677149545841517035434549516a54346748696a4e377a777951515338555071586c765069334a4b746651344a514269494c2b674a526a70377a683966444347687074646a564f4841666945444278364457386371616348566934665974364f5864706e303571515a455958317a596f7a4f68544854534756657a546b7562726c446b4e714a594739676531594855494e4d5449334e6a55344e4449774d4449794d4644707a3672544167702b4342635167534d674e696a787944417951515277736b687477434267507245694e517a566a46536969446649777770726d4f6a3838444958316f6766422b504c4665375a3437687278736c5a4433736b4a596a7a4a32783038654c69434956463630446b585243504f68544e2f496d424b4e7644674b59496c63626f774a6464774830483445494e4d5449344f4455354f4441774d4449774f5644433235436f2f2f2f2f2f2f3842436e67494b5243584c6941564b4d486b417a4a4242476b41454b63335167554e70502b714736366143794749764f674e50796e4f512f596950414a4f5557455137685174615538767a4a73435871534b79704752344257534c395243324d30587948374b7361302b56445136464e53474566514b4e32493776506e77523768546758665965627251516730784d6a63354f544d334d4441774d445930554d72567056304b66676749454f73544947676f765a634d4d6b45454d5847544c426f5872334a572f676c523064696d6e337670676766412b377a616836597450374e422f41517736394d2f4f46645a7869673639576d5057562f367353516b395a3162346b482f35536a652b466734527a6f5531572b2b4d7054715458504d715a2f3464527a6e765a746f6a4e5643445445794e7a55314f5455784d4441794e444a51313432322b50372f2f2f2f2f415170354343385171444567526969643454597951515245356861327a53484445565357464a586274435941674f356473452f2b6f61533954696c6c3830744b6e344e57796a6c534357784a7047384b5858486933593543376347543355366471644f51336c5a6c424470384f68545a4e694a455061487a36427a656269774f5343744e6749516c476b494e4d5449344f5445304e6a59774d444d314d464371682b66654151714141516875454b7057495077644b4f3757686b5979515152314d6b6f7a6b614955376536315071415674556f6a7833414165316741536e385058705330526254696f72515a786d57394232376c482b6e78344a49532b686b526d566a7a52674d6c7059616652365753385861714f68546475444f35344f507939534649446e764c506d6475427a63456655494e4d5449344f5449774d5441774d4449344d5644556e4b4c2b2f762f2f2f2f3842436e34495652446b535342474b497149416a4a4242466e6f4255706c74456a6772724f5356662f31336936666b55763375386647556b4a6975302f41544a51343537325851723671554572787244384a352b76746d47757442784b4d4d34442b6e394c7058777a6830625536464e3347384f5a7152435979397354372b6572504e6a467737696b57516730784d6a67344e4445304d5441774d544179554b5878734a372b2f2f2f2f2f77454b6677674b45507359494c38444b4e4f65547a4a4242442f765062724172434c334a6832665733466e473931717737416b3136696b316a74503661697a7137706f426a4668383254384c2b37656f742f683275705a76536356715a6b66766c78756535733070474d6a30544936464e364e6f6535524a536d3278682f6e78326d762f425944434e3669516730784d6a67354d546b774e5441774d6a413255507a53356f33392f2f2f2f2f77454b66676869455042504946636f797152534d6b4545584351714169697a6c57754a45792f4a7259454e3547416f577477587065305a39756d394c4a4b7970544f45384546744d32365077354a46517159476e74462b48365579375a503463716759396c6f43396d742b4d6a6f5534467267353239594b42664a34783263476c77434b486f78316f6c43445445794f4467304d5459314d4441784f54425133664b6f79502f2f2f2f2f2f4151703543475551775649675169694471304579515151394d2f4b43396b6f44324f71456b49774876664873676354477a4e366b616c5669356e364b377851416e4a7354534a46336c6b706a336e61504b75735069463565514b6e413571675773424a6e515a317653567a754f6854696c73396c4561755648674a7359672b77346d62625457336b6f45494e4d5449344f4467324d6a59774d4449314d464442727036534167702f43426b51747951674f436930394a77474d6b45454155396b526e516a6e4652376c4962685a4f37382b426a377a7943467a524c6732546b7859726c395038647a52366951677833344f305170734767483748464e476d6678316248554971504b653953544e46775047446f55354d314d4d43767633665056524441546161342b3055675755763143445445794f4467344d4467794d4441784d5456517274474274762f2f2f2f2f2f4151702f43475951676c4d6751436963786f59424d6b45454f6639344a4f645a75617a6e582f6c3332472b3231557a5a706e7249665a37584b46433269687a7365397571505a7134654947314434634e554a58657a6f634866356a30463642544d7a427478566b6b74774f6a63446f55356a636e797973366a5734364c5233306d51394547546932656a5243445445794f446b784d6a49324d4441784e446c5130342f652b50372f2f2f2f2f415170354341735172686b674953694368686f795151524f6d6c7a344152696c68446e2b4f45784f796e6b426235572b6f3668704e7761694c706b716f397956364843362f6275467161455650466c6650336b4b796a5469634f686942334949336153486a314b66694873684f68546d717166336662764c372f4c4a73596734485663626b414b426155494e4d5449344f4459304d6a51774d4449334d31434a7666657a4151714141516750454e3066494a304c4b4b756d2b417779515151464d42576b6865424d4f534e72505044645477714e5550544e796936415a79573658484d7443597065465730622b6d2b4d34686965457432524e347879506359365149655551514e6c3059475847314c314562786f4f68546e65372f59375756794478682b2f64454a343431313673707a6855494e4d5449344f5445324f5463774d4441314e3143696f4976782f2f2f2f2f2f3842436f414243463451694534673351456f2f4f6a5846444a4242472f786c6d464d493569386669774b6c61692b58755157424f5031356e6976786b4c4c6635676a686b4d78517266334d67722f6f456e4c4b4543304d66514c4b4d34486c7361504964495a692f4b704770596261535536464f66697934794277512f786b61632f346d5a346a4a7a6d4c736455516730784d6a67354d4445794e6a41774d446330554b5354342b762b2f2f2f2f2f77454b66676866454c4e4f49434d6f35375a364d6b45454e6d4d7138526f4a4c4476613837384b66556c556c4f4269744748415133446a362b72575a542b5849647332566f38533770595052794f4a56326c4642496d79644738366b6a435250396430314b524a544d5141447a6f55364832466a4b672f2f423644637256374c552b4b7176675662786c43445445794f4467784e4463784d4441774d6a6c51345a79627376332f2f2f2f2f41517034434459516d6a556742696944576a4a424250557269396237365659617437505677336764596c446f69534b38372f746c535a6c316d446439452b787874486f51732b6144537132456654744e43454441426d7570597335682b50703237395853575735304c736336464f703356636a387032357348737567786e6a466155725971464b53516730784d6a63314d5451794f4441774d544d7755507179796f5144436e3449574244785443412f4b4d3356436a4a4242506c4331736f39683936624232636d4c6251324e3168314f397374767467365a6247334d63594b6a732b62344b6e4c6346523772694559646665575866654a326d4633615338674330413962392f656b6967366d706736464f394731663531504a6947427562334179594e675772314f775072516730784d6a67344f544d774e5441774d6a513055492b436c6350392f2f2f2f2f77454b66676842455073394941516f2b7355554d6b454537534633423543384d334a664834447365595a79516d732f37466b6953344e6371654632336271514f4f4d68796372582f2f62545270524c4a57563146664878726b435551394e386b6434426a334748394d4f71566a6f5538517242684d5034365965545a3131456d53516171415048594d5a43445445794e7a55354f444d304d4441784f445a517172586e68662f2f2f2f2f2f4151703443414d677878636f674c484141544a42424159413739707a3455424c44466c75434d654d587455574d667758506c383530683375336456784c3831396255514d55394952363069774d474f675779774d447243454254333838635a554465397758493443684659364650684d644e3670626644734975456566444f5a6248503877746769516730784d6a67324e5441794d5441774d446779554d6e5878384d43456f454243486b5176566f673042456f6f7558676a41457951515242352b7a563574322b6475507033455235347466435438586b3241304f34615175487833464168773767367a4a44723174304a70664c7750467a2b55764b323066614d566e414b5a6b6c71466d5033484a733659314f6853336e36314d715946484a454c31505259325839384442662f593655494e4d5449344f5449784d7a4d774d4449784d31443969624f412f2f2f2f2f2f38424b6e45494d68446d4d5341644b4151795151527064794a354955517943502b477437674d4a4a454a6d6c7730494945466d7942704b6f497872774b34786b4c7867624e49662f2f70637152306277725661515a426649493479545936514a587843464b383231674d4f68515172536570624e762f7951717a754476326c5a45554a716166586b494e4d5449334e7a67324d5455774d444d314e43707943413051765230676e68556f42444a42424c7935644242536f62675930634a42433564665874392b4f6d544b7535397a7974626f675a3274657841356158764c31723970326431626e544e526c4c4e7448352b3630796d68692f2f5778656e7361337a763159413646427970635a593732307569767a4e386b475947644b7a2f572b732f516730784d6a67354d54677a4e6a41774d5463314b6e49494b78434c4c79444f456967434d6b45456e4172773841736a4e72337a7144744b614c576371742b452f6e383657596775555854744c513257736666474e3449412f496f41672f7a58774d396930554b73692f75786839755642724166533558307163364f34546f5554345676656656466b71534d69686f66723647776f36774650356c43445445794f446b784f446b774d4441784e54557163676742494c456e4b41457951515138552b7075475754675a77334a72484b7a496b49486946314d58776a4b76683451674d5a692f65776e6a6e36444e356831664c585045685248334e4171466641513630716f664d3773736a3271532f6b45455335334f68525a633547436463416655465664524f6b736e5a7331504b32745645494e4d5449344f4459784d4467774d4445784e5643515469707943483451373245673951456f41544a42424a317a6735746d7a39374e4c737a67333637387033366534366556725648485570644d4a4468666b457656463062675330774c323064476e79532f6d67756f794a4152746c677a6851384f574a6f497a713859583749364646735162306e7a4269436765302b397a727365434c63456d636852516730784d6a67354d5449794e4441774d7a41344b6e4d49674145517a3249676e52456f41544a42424350796f617856773466744b556d38785a65636c51736b786d584c334f55356b54746d4e43332b686d68583472646555694a49743435655137567a5551425936623175366c63794a636a53624373717665446e5557733646463466684d6633305a714e625a474b30725833464b626c30635653516730784d6a67354d6a41324f5441774d6a41784b6e49495952446854794443434367504d6b45452f31754a747a6f6a7230676838454347593756764447497259694373464b4d6a3761687667695336616531485466676f666247592f5155304a5a61456f4674544b4f375a63475364436359717066655156534b4674446f5565314141723471326e395765734e54316469762f56386e4151345643445445794f446b784e544d324d44417a4e54597163676849454e314149496f4b4b4149795151524a744d67305930786f6b39704b734a395539425a7a695038696e55414336535a6c7069586a4377662b796a7170422b456a546c2b674d756a787a536438727a30354a524f73696b4469694b6e6152627367627441734f68523863336c54477972756775544b4274515858524f35792b72395355494e4d5449344f5445344e4449774d4449344e43707943486b5176566f673042456f43544a424245486e374e586d33623532342b6e6352486e6931384a507865545944513768704334664863554348447544724d6b4f765733516d6c387641385850355338726252396f78576341706d53576f57592f63636d7a706a5536464c6566725579706755636b51765539466a5a6633774d462f396a70516730784d6a67354d6a457a4d7a41774d6a457a4b6e49496578436658434338424367424d6b45456475797a535345426a4c55316e3846716a6d64733846586c7356576b576c4863736a7770775746444b774e2f3862754c524b4751303263674c4174745a486734574f5444386a4c5078316732364234664d4f6a5273446f5576474245394b466f6a5975466c716e3331475765435a6865362b5a43445445794f4467354e5467324d4441794e6a45716351686245495a4f4944556f41544a42425054767364776c7a7a5a5470416a6a5a416f543052685676437a5a6c586c3231354f68684a4857644d6d62314241784b2f6952394f754834337a7159334c64307835672b773679566547587053766e487137324b326336464c32395130657767746e5776664c615256576a664f55714c694567516730784d6a67334e6a45314f5441774d7a67314b6e49496268437156694438485367464d6b454564544a4b4d354769464f3375745436674662564b49386477414874594145702f443136557445573034714b3047635a6c7651647535522f703865435345766f5a455a6c59383059444a6157476e30656c6b764632716a6f553362677a7565446a3876556853413537797a356e6267633342483143445445794f446b794d4445774d4441794f4445716351675a454c636b4944676f41544a42424146505a455a304935785565355347345754752f5067592b38386768633053344e6b354d574b3566542f486330656f6b494d642b4474454b62426f422b78785452706e3864577831434b6a796e76556b7a526344786736464f544e544441723739337a3155517745326d7550744649466c4c39516730784d6a67344f4441344d6a41774d5445314b6e49494478446448794364437967424d6b4545425441567049586754446b6a617a7a773355384b6a5644307a636f756747636c756c787a4c516d4b58685674472f70766a4f49596e684c646b54654d636a33474f6b43486c4545445a6447426c7874533952473861446f553533752f324f316c636738596676335243654f4e6465724b63345643445445794f446b784e6a6b334d4441774e546371636768654549684f494e30424b41497951515276385a5a6854434f59764834734370576f766c376b4667546a39655a3472385a4379332b5949345a444d554b33397a494b2f36424a797968417444483043796a4f423562476a794853475976797152715747326b6c4f68546e3473754d67634550385a476e502b4a6d65497963356937485645494e4d5449344f5441784d6a59774d4441334e4449444d544d33222c2270726f6f66223a7b226f7073223a5b7b2274797065223a226961766c3a76222c226b6579223a224e6a49324f54553d222c2264617461223a227141514b7051514b4c416761454a4d564750764936414969494b6d4f6d3754344d5a626d31302b6d72432f65367671447547546649566e354e327256726c30344c776961436977494742446243686a37794f67434b69434e2b566161644b366839383569784a687a714865636a796372685a7959526533742b324679307172727a516f7343425951387751592b386a6f416949676e414350744a714f6843575a7365346768483164366e485472507a70746353596f483978636731683478454b4c416755455034434750764936414969494f38424e466e6b5357554f433675362f694b4738704a2b735a41756d6775374244346a77353439326e6376436977494568443741526a37794f674349694236347263323677506c6774544470657136314d5341546263496341497666337370794d684a4272327039676f7343424151696745592b386a6f41696f6741394b58394f44565253775a427963764c64675274386141774447714b50455675615561445775557971384b4b77674f45456f592b386a6f41694967424d4e4f2f6739515841796b4f4870566d79536e2f6a33614e666d445773337543632f7161762f6a7749554b4b77674d454234592b386a6f416949675439394337726659496e4f55694d4361397067476d5056794f495566746c7864647a546f6d3571716f7a384b4b77674b454249592b386a6f41696f67654c444f6d672b545466495676576b514e576e386258475356552b464355616471695a53425852397462634b4b77674745415959344f7a6e4169496775713068753268302b6e635554554a434e4c6c37546c3555505062555a62514e36362f684a364f416546734b4b7767434541495967642f6e41694967344b53396d36376b6b773561554f37586c696848327175696446336e4d764633612f4332463232386b7959614c676f464e6a49324f545553494d4b446a3137324678543846666d36472f332b674b392b7a736b5843796e6e466d4a57787433584e31736a474b2f433577493d227d2c7b2274797065223a226d756c746973746f7265222c226b6579223a22596d3979222c2264617461223a226877554b6841554b46676f4c63326c6b5a574e6f595735755a57775342776f46434d7a4d3641494b4d516f455958563061424970436963497a4d7a6f416849676332635471574f3743616e45656b35356a346a535036733136797439482b32317853706a6e6b6c765932674b4e776f4b5932686c5932747762326c7564424970436963497a4d7a6f4168496770735649647473707a5256726b43697a54755449504357675731694835662f6c4a754651595736364352554b4d776f47634746795957317a45696b4b4a776a4d7a4f674345694234395045366f7667624c58466f38303376704f2f2b7042786749386e6758733955694c335a634d4e6466676f304367647a644746726157356e45696b4b4a776a4d7a4f6743456942335946336353726e346f2b544150526941506b5a31554a43473836444b6c4978677a59702f5931577342416f7a43675a7a6458427762486b534b516f6e434d7a4d36414953494238665469774b49734143435630514a315378782f324e5056486c6a4e654771414b4475756a6c736f674f436a414b41324a7663684970436963497a4d7a6f416849674d464b327569677046565777776f42627561726174534a78646d4e3653496b61344e57526a6434745678594b4e516f496332786863326870626d63534b516f6e434d7a4d36414953494a454e6b4e6b576a36445448496a6b2b74586d355768696c3845753450616851356e30714243446c6336534368634b44474e6f59576c75625746755957646c63684948436755497a4d7a6f41676f7743674e6e623359534b516f6e434d7a4d36414953494b66437973547449796f415179323974624a30546866766a73414c6a6c50362b39674c737031485445494e436a494b425852766348567745696b4b4a776a4d7a4f67434569436f787a54636a384b6b7642682b556d6c7062617944313047376b452f54347148375171486a3270436937516f784367527459576c7545696b4b4a776a4d7a4f6743456944472b526f5a6a364b336b74415854325a6f7130626830507662426530794543343836705247794f507761776f5043675269595735724567634b42516a4d7a4f6743436a494b42574e735a584a7245696b4b4a776a4d7a4f67434569444f6e38754f3949597665704a334d4632717066304f6f5959304179384431777550494d44434436355462673d3d227d5d7d2c22686569676874223a2235393038303434222c22636f64657370616365223a22227d7d")

	// getProofForSpan(1)
	// getHeimdallGenesis(height, false)
	// return

	var resp ctypes.ResultABCIQuery
	err := json.Unmarshal(span2695ProofResp, &resp)
	if err != nil {
		panic(err)
	}

	keyPath := "/"
	for i := range resp.Response.Proof.Ops {
		op := resp.Response.Proof.Ops[len(resp.Response.Proof.Ops)-1-i]
		keyPath += "x:" + hex.EncodeToString(op.Key)
		keyPath += "/"
	}
	keyPath = strings.TrimSuffix(keyPath, "/")

	cpv := CosmosProofValue{
		Kp:    keyPath,
		Value: resp.Response.Value,
	}

	proofBytes, _ := json.Marshal(resp.Response.Proof)
	cpvBytes, _ := json.Marshal(cpv)

	fmt.Println("height", resp.Response.Height, "proofBytes", hex.EncodeToString(proofBytes), "cpvBytes", hex.EncodeToString(cpvBytes))

}

func jsonRequest(url string, data []byte) (result []byte, err error) {
	resp, err := http.Post(url, "application/json", strings.NewReader(string(data)))
	if err != nil {
		return
	}

	defer resp.Body.Close()

	return ioutil.ReadAll(resp.Body)
}

func changeHeader(genesis *CosmosHeader, client *rpcClient.HTTP) *CosmosHeader {
	height := genesis.Header.Height + 1
	for {
		commit, err := client.Commit(&height)
		if err != nil {
			fmt.Printf("rpc fail:%v\n", err)
			continue
		}
		if !bytes.Equal(commit.NextValidatorsHash, genesis.Header.NextValidatorsHash) {
			vals, err := client.Validators(&height)
			if err != nil {
				fmt.Printf("rpc fail:%v\n", err)
				continue
			}

			fmt.Println("height", height)
			return &CosmosHeader{Valsets: vals.Validators, Header: *commit.Header, Commit: commit.Commit}
		} else {
			height++
		}
	}
}

type PolygonExtraInfo struct {
	Sprint              uint64
	Period              uint64
	ProducerDelay       uint64
	BackupMultiplier    uint64
	HeimdallPolyChainID uint64
}

func printBorExtra() {
	extra := PolygonExtraInfo{
		Sprint:              64,
		Period:              2,
		ProducerDelay:       6,
		BackupMultiplier:    2,
		HeimdallPolyChainID: 15,
	}
	extraBytes, _ := json.Marshal(extra)
	fmt.Println("extraBytes", string(extraBytes))
}

func main() {

	// getProofForSpan(2695)
	// verifySpan()
	// getHeimdallGenesis(5908043, false)
	// return

	// // verifySpan()
	// // getBorGenesis()
	// return

	client := rpcClient.NewHTTP(TendermintRPCUrl, "/websocket")
	status, err := client.Status()
	if err != nil {
		panic(fmt.Sprintf("client.Status error: %v", err))
	}

	fmt.Println("status", status)
	// err := httpClient.Start()
	// if err != nil {
	// 	panic(fmt.Sprintf("Error connecting to server %v", err))
	// }

	height := 100
	for i := 0; i < 50; i++ {
		height0 := int64(height + i)
		commit0, err := client.Commit(&height0)
		if err != nil {
			panic(err)
		}

		height1 := int64(height + i + 1)

		vals1, err := client.Validators(&height1)
		if err != nil {
			panic(err)
		}

		commit1, err := client.Commit(&height1)
		if err != nil {
			panic(err)
		}

		return
		info := &CosmosEpochSwitchInfo{
			NextValidatorsHash: commit0.NextValidatorsHash,
			ChainID:            commit0.ChainID,
		}

		header := &CosmosHeader{
			Header:  *commit1.Header,
			Commit:  commit1.Commit,
			Valsets: vals1.Validators,
		}

		err = VerifyCosmosHeader(header, info)
		if err != nil {
			panic(fmt.Sprintf("VerifyCosmosHeader:%v", err))
		} else {
			fmt.Println("VerifyCosmosHeader ok")
		}
	}

}
